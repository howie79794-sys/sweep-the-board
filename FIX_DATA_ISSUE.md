# 数据丢失问题修复指南

## 问题诊断结果

✅ **好消息：数据并没有丢失！**

通过检查发现：
- ✅ 数据库文件存在且正常
- ✅ **有 8 个用户**（用户1-用户8）
- ✅ **有 8 个资产**（协创数据、卧龙电驱、上海电气等）

## 真正的问题

问题在于**后端服务没有正确运行**，导致前端无法获取数据。

## 解决步骤

### 1. 停止旧的后端服务（如果有）

```bash
# 查找并停止旧的进程
pkill -f "uvicorn.*app.main"
pkill -f "uvicorn.*api.main"
```

### 2. 重新启动后端服务

方法一：使用启动脚本（推荐）
```bash
cd "/Users/zhuangjiaxuan/Cursor/赚麻了/sweep the board"
./start_backend.sh
```

方法二：手动启动
```bash
cd backend
python3 run.py
```

### 3. 验证服务运行

在浏览器中访问：
- http://localhost:8000/api/health
- http://localhost:8000/api/users
- http://localhost:8000/api/assets

应该能看到数据返回。

### 4. 刷新前端页面

在前端管理界面刷新页面，数据应该正常显示。

## 已完成的修复

1. ✅ 添加了全局异常处理器，防止 500 错误
2. ✅ 创建了数据库状态检查脚本
3. ✅ 创建了后端启动脚本
4. ✅ 数据获取服务已更新（yfinance + baostock）

## 验证数据存在

运行以下命令验证数据确实存在：

```bash
cd backend
python3 check_service.py
```

输出应该显示：
```
✓ 数据库连接成功
用户数据: 8 个用户
资产数据: 8 个资产
```

## 常见问题

### Q: 为什么显示 HTTP 500 错误？
A: 因为后端服务没有运行或者配置错误。启动后端服务后问题会解决。

### Q: 数据真的没有丢失吗？
A: 是的，数据库中有 8 个用户和 8 个资产。只是后端服务没有运行，前端无法获取。

### Q: 如何确保后端服务持续运行？
A: 使用 `./start_backend.sh` 启动服务，或者使用进程管理器（如 PM2）来保持服务运行。
